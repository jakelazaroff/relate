!function(t){"use strict";var n=Object.keys,r=Array.isArray,o=function(t){return"object"==typeof t&&!!t},e=function(t){return"function"==typeof t&&!!t},i={};i.VERSION="0.8.1";var c=i.map={};i._map=function(t){var r={},o={};return n(t||{}).forEach(function(n){r[t[n]]=!0,o[n]=t[n]}),n(i.collections).forEach(function(t){r[t]||(o[t]=t)}),o};var a=i.transform={};i.defaultTransform=function(t,n){return t};var f=i.Collection=function(t,n){var r=this;n=n||{},r.name=t,r.store={},r._map=n.map||{},r._transform=n.transform};f.prototype.map=function(){var t=this;return i._map(t._map)},f.prototype.add=function(t){var n=this;if(n.store[t.id])throw new Error("Item with id "+t.id+' already exists in collection "'+n.name+'".');return t=n._transform(t,n),i.mixin&&i._mixin(t,n),n.store[t.id]=t},f.prototype["import"]=function(t){var n=this;t.forEach(function(t){n.add(t)})},f.prototype.get=function(t){var i=this;return r(t)?t.map(function(t){return i.store[t]}):e(t)?i.get(n(i.store).filter(function(n){return t(i.store[n])})):o(t)?i.get(function(n){for(var r in t)if(t[r]!==n.get(r))return!1;return!0}):i.store[t]};var u=i.collections={};i.collection=function(t){if(!i.collection.exists(t))throw new Error('Collection "'+t+'" does not exist.');return u[t]},i.collection.create=function(t,n){if(i.collection.exists(t))throw new Error('Collection "'+t+'" already exists.');return n=n||{},u[t]=new f(t,{transform:n.transform||a[t]||i.defaultTransform,map:n.map||c[t]}),u[t]},i.collection.exists=function(t){return t&&t in u},i["import"]=function(t){n(t).map(function(t){return i.collection.create(t)}).forEach(function(n){n["import"](t[n.name])})};var s=i.Relation=function(){this.init&&this.init.apply(this,arguments)};s.prototype.related=void 0,s.prototype.init=function(t,n){var r=this;r.collection=t,n&&(r.related=n)},s.prototype.get=function(){var t=this;return t.collection.get(t.related)};var l=i.Item={};l.prefix=void 0,l.get=function(t){var n=this,r=n[t];return r instanceof s?r.get():r},i.mixin=!0,i._mixin=function(t,r){var o=r.map();n(o).forEach(function(n){t[n]&&(t[n]=new s(i.collection(o[n]),t[n]))});var e=l.prefix?t[l.prefix]={}:t;["get"].forEach(function(n){e[n]=l[n].bind(t)})};var p=t.Relate;i.noConflict=function(){return t.relate=p,i},"function"==typeof define&&define.amd?define([],function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:t.Relate=i}(this);
