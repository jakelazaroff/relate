!function(t){"use strict";var n=Object.keys,r=Array.isArray,o=function(t){return"object"==typeof t&&!!t},e={};e.VERSION="0.7.0";var i=e.map={};e._map=function(t){var r={},o={};return n(t||{}).forEach(function(n){r[t[n]]=n}),n(e.collections).forEach(function(t){r[t]?o[r[t]]=t:o[t]=t}),o};var a=e.transform={},c=(e.defaultTransform=function(t,n){return t},e.Collection=function(t,n){var r=this,n=n||{};r.name=t,r.store={},r._map=n.map||{},r._transform=n.transform});c.prototype.map=function(){var t=this;return e._map(t._map)},c.prototype.add=function(t){var n=this;if(n.store[t.id])throw new Error("Item with id "+t.id+' already exists in collection "'+n.name+'".');return t=n._transform(t,n),e.mixin&&e._mixin(t,n),n.store[t.id]=t},c.prototype["import"]=function(t){var n=this;t.forEach(function(t){n.add(t)})},c.prototype.get=function(t){var e=this;return r(t)?t.map(function(t){return e.store[t]}):o(t)?e.get(n(e.store).filter(function(n){var r=e.store[n];for(var o in t)if(t[o]!==r[o])return!1;return!0})):e.store[t]};var f=e.collections={};e.collection=function(t){if(!e.collection.exists(t))throw new Error('Collection "'+t+'" does not exist.');return f[t]},e.collection.create=function(t,n){if(e.collection.exists(t))throw new Error('Collection "'+t+'" already exists.');return n=n||{},f[t]=new c(t,{transform:n.transform||a[t]||e.defaultTransform,map:n.map||i[t]}),f[t]},e.collection.exists=function(t){return t&&t in f},e["import"]=function(t){n(t).map(function(t){return e.collection.create(t)}).forEach(function(n){n["import"](t[n.name])})};var u=e.Relation=function(){this.init&&this.init.apply(this,arguments)};u.prototype.related=void 0,u.prototype.init=function(t,n){var r=this;r.collection=t,n&&(r.related=n)},u.prototype.get=function(){var t=this;return t.collection.get(t.related)};var s=e.Item={};s.prefix=void 0,s.get=function(t){var n=this,r=n[t];return r instanceof u?r.get():r},e.mixin=!0,e._mixin=function(t,r){var o=r.map();n(o).forEach(function(n){t[n]&&(t[n]=new u(e.collection(o[n]),t[n]))});var i=s.prefix?t[s.prefix]={}:t;["get"].forEach(function(n){i[n]=s[n].bind(t)})};var l=t.Relate;e.noConflict=function(){return t.relate=l,e},"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports?exports=module.exports=e:t.Relate=e)}(this);